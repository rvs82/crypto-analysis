<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="robots" content="noindex"><title>Crypto Trading</title><style>body{font-family:'Arial Narrow',Arial,sans-serif;margin:20px;background:#f0f0f0;overflow-y:auto}table{width:100%;border-collapse:collapse;margin-top:20px;background:#fff}th,td{padding:8px;border:1px solid #ddd;text-align:center;font-size:12px}th{background:#4CAF50;color:#fff}.long{color:green}.short{color:red}.neutral{color:#000}.market-flat{display:inline-block;width:8px;height:8px;border:1px solid #000;background:yellow;vertical-align:middle;margin-left:4px}.market-up{display:inline-block;width:8px;height:8px;border:1px solid #000;background:#90ee90;vertical-align:middle;margin-left:4px}.market-down{display:inline-block;width:8px;height:8px;border:1px solid #000;background:red;vertical-align:middle;margin-left:4px}.up{color:green;font-size:14px;vertical-align:middle;margin-right:4px}.down{color:red;font-size:14px;vertical-align:middle;margin-right:4px}.blink-green{animation:blinkGreen 2s infinite}.blink-red{animation:blinkRed 2s infinite}@keyframes blinkGreen{0%{background:#fff}50%{background:rgba(0,255,0,0.1)}100%{background:#fff}}@keyframes blinkRed{0%{background:#fff}50%{background:rgba(255,0,0,0.1)}100%{background:#fff}}#marketMood{width:100%;height:40px;display:flex;justify-content:space-between;align-items:center;color:#fff;font-size:14px;transition:background 1s ease}#marketMood .longs{flex:1;text-align:left;padding-left:10px}#marketMood .shorts{flex:1;text-align:right;padding-right:10px}#tradeMain,#tradeTest{margin-top:15px;font-size:13px;border:1px solid #ddd;padding:8px}#tradeMain strong,#tradeTest strong{font-weight:bold}#reasoningMain,#reasoningTest{margin-top:8px;font-size:13px}#statsMain,#statsTest{margin-top:8px;font-size:13px;border:1px solid #ddd;padding:8px;display:flex;align-items:center}#marketReasoning{margin-top:15px;font-size:13px;border:1px solid #ddd;padding:8px}#marketReasoning select{margin-right:10px;font-size:12px;padding:2px}details{margin-top:5px;width:100%}summary{cursor:pointer;display:flex;align-items:center}summary::marker{content:"Ў ";font-size:10px;margin-right:4px}#forecastAI,#aiLog{font-family:'Arial Narrow',Arial,sans-serif;font-size:12px}#forecastAI details,#aiLog details{margin-bottom:8px}#forecastAI .block,#aiLog .block{border:1px solid #ddd;padding:5px;margin-bottom:5px}.tech-block{border:1px solid #ddd;padding:8px;margin-top:5px;font-size:11px}h2{font-family:'Arial Narrow',Arial,sans-serif;font-size:14px;margin:0 0 5px 0}button{padding:4px 8px;margin-left:8px;background:#ccc;border:none;cursor:pointer;font-size:12px}button:hover{background:#999}.new-learning{color:green}.new-mistake{color:red}</style></head><body><div id="marketMood"><div class="longs">Лонги 0%</div><div class="shorts">Шорты 0%</div></div><table><thead><tr><th>Пара</th><th>5м</th><th>15м</th><th>30м</th><th>1ч</th><th>4ч</th><th>1д</th><th>1н</th></tr></thead><tbody id="data"></tbody></table><div id="tradeMain"><strong>Сделка:</strong> Нет</div><div id="reasoningMain"></div><div id="statsMain"><strong>Статистика:</strong> Загрузка... <button onclick="resetStatsMain()">Сбросить</button></div><div id="tradeTest"><strong>Сделка (тест 5m):</strong> Нет</div><div id="reasoningTest"></div><div id="statsTest"><strong>Статистика (тест 5m):</strong> Загрузка... <button onclick="resetStatsTest()">Сбросить</button></div><div id="marketReasoning"><strong>Рассуждения ИИ о рынке:</strong><select id="currencySelect"><option value="all">Все валюты</option><option value="LDOUSDT">LDOUSDT</option><option value="AVAXUSDT">AVAXUSDT</option><option value="AAVEUSDT">AAVEUSDT</option></select><select id="timeframeSelect"><option value="all">Все таймфреймы</option><option value="5m">5m</option><option value="15m">15m</option><option value="30m">30m</option><option value="1h">1h</option><option value="4h">4h</option><option value="1d">1d</option><option value="1w">1w</option></select><div id="reasoningText">Загрузка...</div></div><div id="forecastAI"><h2>Прогноз ИИ:</h2><br></div><div id="aiLog"><h2>Лог ИИ:</h2><div class="block"><br></div></div><details class="tech-block"><summary>Техническое задание</summary><strong>Обновлено 26.03.2025:</strong><br>Сайт для трейдинга (LDOUSDT, AVAXUSDT, AAVEUSDT) с прогнозами ИИ, статистикой и логами. Оптимизирован для Render (512 МБ RAM, 0.1 CPU). Использует WebSocket Binance Futures, обновление каждые 10 сек (UTC+3). Логи в Google Drive (планируется).<br>Дизайн: Фон #F0F0F0, таблица #FFF, заголовки #4CAF50, "Лонг" #008000, "Шорт" #FF0000, "Нет" #000, квадратики: Флет #FFFF00, Восходящий #90EE90, Нисходящий #FF0000, стрелки ^/v #008000/#FF0000, полоса рынка градиент #008000-#FF0000, шрифт Arial Narrow.<br>Функциональность: Таблица с сигналами, сделки при пробое канала (>50%), обновление 10 сек, звук при пробое, мигание ячеек: зелёное при пробое вверх, красное при пробое вниз.<br>ИИ: Nadaraya-Watson (bandwidth=8, multiplier=3, limit=1000), EMA 50/200, учитывает объёмы, тренд, корреляцию BTC/ETH, консолидацию (+10% при совпадении Nadaraya и боковика). Обучение: +5% при прибыли, -5% при убытке.</details><details class="tech-block"><summary>Как работает сайт</summary>Сайт для трейдинга с ИИ. Использует Nadaraya-Watson Envelope (bandwidth=8, multiplier=3, limit=1000): пробой вверх — "Шорт", вниз — "Лонг". Консолидация (?3 отскока, горизонтальность <0.5%) усиливает сигнал (+10%). Данные через WebSocket Binance Futures, обновление 10 сек. Сделки: 100 USDT, стоп 0.5%, профит 1%. ИИ учитывает тренд, объёмы, EMA, корреляцию. Мигание ячеек при пробое: зелёное вверх, красное вниз. Обучение онлайн.<br><strong>Чему научился ИИ:</strong><br>Пока нет данных<br><strong>Ошибки ИИ:</strong><br>Пока нет данных</details><div><input type="checkbox" id="channelExitCheckbox" checked> Звук</div><script>const tbody=document.getElementById('data'),tradeMainDiv=document.getElementById('tradeMain'),reasoningMainDiv=document.getElementById('reasoningMain'),statsMainDiv=document.getElementById('statsMain'),tradeTestDiv=document.getElementById('tradeTest'),reasoningTestDiv=document.getElementById('reasoningTest'),statsTestDiv=document.getElementById('statsTest'),marketReasoningDiv=document.getElementById('marketReasoning'),currencySelect=document.getElementById('currencySelect'),timeframeSelect=document.getElementById('timeframeSelect'),reasoningTextDiv=document.getElementById('reasoningText'),forecastAIDiv=document.getElementById('forecastAI'),aiLogDiv=document.getElementById('aiLog'),marketMood=document.getElementById('marketMood');let lastSignal={},trendUpdateCounter={},openDetails={},lastTrends={},lastData=null;function throttle(func,limit){let inThrottle;return function(...args){if(!inThrottle){func.apply(this,args);inThrottle=true;setTimeout(()=>{inThrottle=false;},limit);}}}async function updateData(){try{const response=await fetch('/data',{cache:'no-store'});if(!response.ok)throw new Error(`HTTP error: ${response.status}`);const data=await response.json();console.log(`Данные ${new Date().toLocaleString('ru-RU',{timeZone:'Europe/Moscow'})}:`,data);if(!data.recommendations||!data.tradesMain||!data.tradesTest||!data.prices)throw new Error('Некорректные данные');lastData=data;renderUI(data);}catch(error){console.error('Ошибка:',error);tbody.innerHTML='<tr><td colspan="8">Ошибка: '+error.message+'</td></tr>';}}function renderUI(data){tbody.innerHTML='';let forecastHtml='<h2>Прогноз ИИ:</h2><br>',logHtml='<h2>Лог ИИ:</h2><div class="block">',symbols=['LDOUSDT','AVAXUSDT','AAVEUSDT'],totalLongs=0,totalShorts=0,totalCount=0;for(const symbol of symbols){const rec=data.recommendations[symbol]||{},tradeMain=data.tradesMain[symbol],tradeTest=data.tradesTest[symbol],row=document.createElement('tr');trendUpdateCounter[symbol]=trendUpdateCounter[symbol]||{};lastTrends[symbol]=lastTrends[symbol]||{};forecastHtml+=`<details ${openDetails[symbol]?'open':''}><summary>${symbol}</summary>`;row.innerHTML=`<td style="width:100px;white-space:nowrap">${symbol}<br>${data.prices[symbol].toFixed(4)}</td>`+TIMEFRAMES.map(tf=>{const r=rec[tf]||{direction:'Нет',confidence:0,market:'Флет',trend:'боковик',pivot:data.prices[symbol],reasoning:'Нет данных',shortReasoning:'Нет данных',forecast:'падение',outsideChannel:false,touchesBoundary:false,isFlat:false},cls=r.direction==='Лонг'?'long':r.direction==='Шорт'?'short':'neutral',marketCls=r.market==='Флет'?'market-flat':r.market==='Восходящий'?'market-up':'market-down';trendUpdateCounter[symbol][tf]=(trendUpdateCounter[symbol][tf]||0)+1;const trendArrow=(trendUpdateCounter[symbol][tf]%5===0||!lastTrends[symbol][tf])?(r.trend==='вверх'?'^':r.trend==='вниз'?'v':'^'):lastTrends[symbol][tf];lastTrends[symbol][tf]=trendArrow;const signalKey=`${symbol}-${tf}-${r.outsideChannel}`,blinkCls=r.outsideChannel?(r.direction==='Шорт'?'blink-green':'blink-red'):'';if(r.outsideChannel&&lastSignal[signalKey]!==true&&document.getElementById('channelExitCheckbox').checked&&r.confidence>=50){const audio=new Audio('https://freesound.org/data/previews/339/339810_5121236-lq.mp3');audio.play().catch(()=>console.log(`Колокольчик для ${symbol} не воспроизведён`));lastSignal[signalKey]=true;}else if(!r.outsideChannel)lastSignal[signalKey]=false;forecastHtml+=`<div class="block">${tf}: прогноз: <span class="${r.forecast==='рост'?'up':r.forecast==='падение'?'down':'neutral'}">${r.forecast}</span>, ${r.shortReasoning}</div>`;if(r.direction==='Лонг'){totalLongs+=r.confidence;totalCount++;}else if(r.direction==='Шорт'){totalShorts+=r.confidence;totalCount++;}return `<td class="${cls} ${blinkCls}"><span class="${marketCls}"></span> ${r.direction}${r.confidence>0?` ${Math.min(r.confidence,100)}%`:''} <span class="${r.trend==='вверх'?'up':'down'}">${trendArrow}</span></td>`;}).join('');forecastHtml+=`</details>`;tbody.appendChild(row);if(tradeMain.active){const cls=tradeMain.active.direction==='Лонг'?'long':'short';tradeMainDiv.innerHTML=`<strong>Сделка:</strong> ${symbol} (${tradeMain.active.timeframe}) <span class="${cls}">${tradeMain.active.direction}</span> (${rec[tradeMain.active.timeframe]?.confidence||0}%), Открытие: ${tradeMain.active.entry.toFixed(4)}, Стоп: ${tradeMain.active.stopLoss.toFixed(4)}, Профит: ${tradeMain.active.takeProfit.toFixed(4)}`;reasoningMainDiv.innerHTML=`<strong>Рассуждения ИИ:</strong> ${rec[tradeMain.active.timeframe]?.reasoning||'Нет данных'}`;}else{tradeMainDiv.innerHTML='<strong>Сделка:</strong> Нет';reasoningMainDiv.innerHTML=`<strong>Рассуждения ИИ:</strong> ${rec['5m']?.reasoning||'Нет активных сделок'}`;}statsMainDiv.innerHTML=`<strong>Статистика:</strong> Открыто: ${tradeMain.openCount}, Закрыто: ${tradeMain.closedCount}, Стоп: ${tradeMain.stopCount}, Профит: ${tradeMain.profitCount}, Прибыль: ${tradeMain.totalProfit.toFixed(2)} USDT, Убыток: ${tradeMain.totalLoss.toFixed(2)} USDT <button onclick="resetStatsMain()">Сбросить</button>`;if(tradeTest.active){const cls=tradeTest.active.direction==='Лонг'?'long':'short';tradeTestDiv.innerHTML=`<strong>Сделка (тест 5m):</strong> ${symbol} (${tradeTest.active.timeframe}) <span class="${cls}">${tradeTest.active.direction}</span> (${rec[tradeTest.active.timeframe]?.confidence||0}%), Открытие: ${tradeTest.active.entry.toFixed(4)}, Стоп: ${tradeTest.active.stopLoss.toFixed(4)}, Профит: ${tradeTest.active.takeProfit.toFixed(4)}`;reasoningTestDiv.innerHTML=`<strong>Рассуждения ИИ:</strong> ${rec[tradeTest.active.timeframe]?.reasoning||'Нет данных'}`;}else{tradeTestDiv.innerHTML='<strong>Сделка (тест 5m):</strong> Нет';reasoningTestDiv.innerHTML=`<strong>Рассуждения ИИ:</strong> ${rec['5m']?.reasoning||'Нет активных сделок'}`;}statsTestDiv.innerHTML=`<strong>Статистика (тест 5m):</strong> Открыто: ${tradeTest.openCount}, Закрыто: ${tradeTest.closedCount}, Стоп: ${tradeTest.stopCount}, Профит: ${tradeTest.profitCount}, Прибыль: ${tradeTest.totalProfit.toFixed(2)} USDT, Убыток: ${tradeTest.totalLoss.toFixed(2)} USDT <button onclick="resetStatsTest()">Сбросить</button>`;}const selectedCurrency=currencySelect.value,selectedTimeframe=timeframeSelect.value;reasoningTextDiv.innerHTML=selectedCurrency==='all'||selectedTimeframe==='all'?data.marketOverview||'Нет данных':data.recommendations[selectedCurrency][selectedTimeframe]?.reasoning||'Нет данных';const longPercent=totalCount>0?Math.round(totalLongs/totalCount):0,shortPercent=totalCount>0?Math.round(totalShorts/totalCount):0;marketMood.style.background=`linear-gradient(to right, green ${longPercent}%, red ${longPercent}%)`;marketMood.querySelector('.longs').textContent=`Лонги ${longPercent}%`;marketMood.querySelector('.shorts').textContent=`Шорты ${shortPercent}%`;forecastAIDiv.innerHTML=forecastHtml||'<h2>Прогноз ИИ:</h2> Нет данных';logHtml+=(data.aiLogs||[]).map(log=>`<p>${log}</p>`).join('')||'Нет записей';logHtml+='</div>';aiLogDiv.innerHTML=logHtml;const howItWorks=document.querySelector('#howItWorks');if(howItWorks){const learnings=(data.aiLearnings||[]).map((learn,i)=>i===data.aiLearnings.length-1?`<span class="new-learning">${learn}</span>`:learn).join('<br>'),mistakes=(data.aiMistakes||[]).map((mistake,i)=>i===data.aiMistakes.length-1?`<span class="new-mistake">${mistake}</span>`:mistake).join('<br>');howItWorks.innerHTML=howItWorks.innerHTML.split('<strong>Чему научился ИИ:</strong>')[0]+`<strong>Чему научился ИИ:</strong><br>${learnings||'Пока нет данных'}<br><br><strong>Ошибки ИИ:</strong><br>${mistakes||'Пока нет данных'}`;}}const TIMEFRAMES=['5m','15m','30m','1h','4h','1d','1w'];function resetStatsMain(){fetch('/reset-stats-main',{method:'POST'}).then(updateData).catch(error=>console.error('Ошибка сброса (main):',error));}function resetStatsTest(){fetch('/reset-stats-test',{method:'POST'}).then(updateData).catch(error=>console.error('Ошибка сброса (test):',error));}document.addEventListener('click',e=>{const summary=e.target.closest('summary');if(summary){const symbol=summary.textContent.trim();openDetails[symbol]=!openDetails[symbol];}});const throttledUpdate=throttle(updateData,10000);document.addEventListener('DOMContentLoaded',()=>{console.log('DOM загружен');updateData();setInterval(throttledUpdate,10000);currencySelect.addEventListener('change',updateData);timeframeSelect.addEventListener('change',updateData);});</script></body></html>
