<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Crypto Trading</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f0f0; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 15px; }
        th { background-color: #4CAF50; color: white; }
        .long { color: green; }
        .short { color: red; }
        .neutral { color: black; }
        #trade, #stats, #indicators, #techSpec { margin-top: 20px; font-size: 15px; }
        details { margin-top: 5px; }
        summary { cursor: pointer; }
    </style>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th>Пара</th>
                <th>15м</th>
                <th>30м</th>
                <th>1ч</th>
                <th>4ч</th>
                <th>1д</th>
                <th>1н</th>
            </tr>
        </thead>
        <tbody id="data"></tbody>
    </table>
    <div id="trade"><strong>Сделка:</strong> Нет</div>
    <div id="stats"></div>
    <div id="indicators">
        <details>
            <summary>Индикаторы и фильтры</summary>
            <div id="indicators-content"></div>
        </details>
    </div>
    <div id="techSpec">
        <strong>Техническое задание:</strong><br>
        <strong>Новый вариант:</strong><br>
        Сайт переделан под использование индикатора Nadaraya-Watson Envelope [LuxAlgo] с режимом Repainting Smoothing, настройками bandwidth 8, multiplier 3, данными закрытия на таймфреймах 15м, 30м, 1ч, 4ч, 1д, 1н. Для точности сигналов добавлены индикаторы RSI, MACD, ADX. Обработка данных выполняется искусственным интеллектом (ИИ) с учётом общей динамики рынка, цен BTC и ETH. Данные выводятся в горизонтальной таблице с рекомендациями для каждого таймфрейма: "Нет" (нейтрально, чёрный), "Лонг" (зелёный), "Шорт" (красный). Под таблицей поле "Сделка" показывает цену открытия, стоп-лосс и тейк-профит (неизменные до закрытия). Ниже — статистика открытых и закрытых сделок. Убрана графа настроения рынка и лишние запросы для оптимизации. Под статистикой — выпадающее меню с индикаторами и фильтрами (значения). Добавлена вертикальная прокрутка при необходимости.
    </div>

    <script>
        const tbody = document.getElementById('data');
        const tradeDiv = document.getElementById('trade');
        const statsDiv = document.getElementById('stats');
        const indicatorsContent = document.getElementById('indicators-content');

        function updateData() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    tbody.innerHTML = '';
                    let indicatorsHtml = '';

                    for (const symbol in data.recommendations) {
                        const row = document.createElement('tr');
                        const rec = data.recommendations[symbol];
                        const trade = data.trades[symbol];
                        row.innerHTML = `
                            <td>${symbol}</td>
                            ${TIMEFRAMES.map(tf => {
                                const r = rec[tf];
                                const cls = r.direction === 'Лонг' ? 'long' : r.direction === 'Шорт' ? 'short' : 'neutral';
                                if (tf === '15m') {
                                    indicatorsHtml += `<strong>${symbol} (${tf}):</strong> NW Upper: ${r.indicators.nw_upper}, NW Lower: ${r.indicators.nw_lower}, NW Smooth: ${r.indicators.nw_smooth}, RSI: ${r.indicators.rsi}, MACD: ${r.indicators.macd}/${r.indicators.signal}, ADX: ${r.indicators.adx}, ATR: ${r.indicators.atr}<br>`;
                                }
                                return `<td class="${cls}">${r.direction}</td>`;
                            }).join('')}
                        `;
                        tbody.appendChild(row);

                        tradeDiv.innerHTML = trade.active ? `<strong>Сделка:</strong> ${trade.active.direction}, Открытие: ${trade.active.entry.toFixed(4)}, Стоп: ${trade.active.stopLoss.toFixed(4)}, Профит: ${trade.active.takeProfit.toFixed(4)}` : '<strong>Сделка:</strong> Нет';
                        statsDiv.innerHTML = `<strong>Статистика:</strong> Открыто: ${trade.openCount}, Закрыто: ${trade.closedCount}, Стоп: ${trade.stopCount}, Профит: ${trade.profitCount}, Прибыль: ${trade.totalProfit.toFixed(2)} USDT, Убыток: ${trade.totalLoss.toFixed(2)} USDT`;
                    }

                    indicatorsContent.innerHTML = indicatorsHtml;
                })
                .catch(error => console.error('Ошибка получения данных:', error));
        }

        const TIMEFRAMES = ['15m', '30m', '1h', '4h', '1d', '1w'];
        updateData();
        setInterval(updateData, 5000);
    </script>
</body>
</html>
